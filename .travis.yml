dist: trusty
language: java
jdk: oraclejdk8

install:
  - ./gradlew clean jar

script:
  - ./gradlew jacocoTestReport
  - find . -name jacocoTestReport.csv | xargs cat| awk -F',' '{print $3" "$4" "$5}'

jobs: 
  include:
    - name: Test UI
      script: COVERAGE=0.5 ./gradlew -p ./monolithic/ui check
    - name: Test service/cart
      script: COVERAGE=0.5 ./gradlew -p ./monolithic/service/cart check
    - name: Test repository/cart
      script: COVERAGE=0.5 ./gradlew -p ./monolithic/repository/cart check
    - name: Test repository/product
      script: COVERAGE=0.5 ./gradlew -p ./monolithic/repository/product check
    - name: Test service/user
      script: COVERAGE=0.5 ./gradlew -p ./monolithic/service/user check
    - name: Test repository/order
      script: COVERAGE=0.3 ./gradlew -p ./monolithic/repository/order check
    - name: Test repository/user
      script: COVERAGE=0.3 ./gradlew -p ./monolithic/repository/user check


before_deploy: 
  - COVERAGE=$COVERAGE_THRESHOLD ./gradlew check jacocoTestCoverageVerification

deploy:
  - provider: script