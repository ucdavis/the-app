language: java

jdk: 
 - oraclejdk8
 - oraclejdk9

services:
  - docker

env: 
 matrix:
   - COVERAGE=0.5 .gradlew -p ./monolithic/ui check
   - COVERAGE=0.5 .gradlew -p ./monolithic/service/cart check
   - COVERAGE=0.5 .gradlew -p ./monolithic/service/user check

   - COVERAGE=0.35 .gradlew -p ./monolithic/repository/order check
   - COVERAGE=0.5 .gradlew -p ./monolithic/repository/cart check
   - COVERAGE=0.5 .gradlew -p ./monolithic/repository/product check
   - COVERAGE=0.33 .gradlew -p ./monolithic/repository/user check

global:
  - secure: 4V6V1ga/wMhIOLDW9Cqjqzd7GdFKpCw0lBEVdvmZhwUvbBGopuHiEK0tqc3+vBF5WH+liPo73Ixu/bQeQwKqnkSrhk7N73hgEymtKOzVIfbmKKo/ixUK9es7SzV/4sAX8alAVkZxgVo/rIrpAcoZY5DT/fac3gXRlI63WtkP9mkj+H50ECBESDa6ZdTLDrSJ5GW3kYsts70yO5bZe2T4a01bFGVvMQEqGRZF2S6kt+BPwO+vSwmobXG9B2egUTHJaLstZpajaTY143RDIKCCrSXK1IYhLuUGlthcEsSi85qA346HXpOXrcBUkZSOuZtfbjlIW48udRUBLq4zi3qsJgljgKu7I8nJ9lpkKmhvuZuTuJTtkv9NjbuOuQy9Er8riwRN9xI+Tp9+httKExS3xEEdpYd0DLEbsobZ4rH0p27T/FeZQR+YdJ6fOeHXtdvxk/xyi+/JTkR9jqF2+en30TZ9nF2VNWL3pjhDSdNHqx1gq6yLP/4fG9DAvV1cKALW8Dp0dyfKheTLCr5e/nTr30wtX7mZPL2ubjZG2aThWB5MvhBxqI4/ODCmp1WuKgXGdkOuyMXavWvoCSCtNzVRyCYwCqNcBeH9QzxXEDXMxi9Vl99IAFOM4al2kCgOL1LoxlbbK/VVleubULnDUzUTpooZxF1dCDwx8W5nHqkjjyT=
  - secure: nK6o1Z8UjfqNXZBJhkMw4iS0abHoFwE9AvvOl6pouN3eCNFVDxfcC66OS2d2pAo1+PszvFClE3EU/ciykaq1FiPysOZ6obc3fwUgzkGAvg/ye9O7E4OKiixAZn7dB1pqjGnKAc/dwaHLIOIDBqLHtaM3rHUvwP0c4QbI15oWf7hXjUQYOeog5wFm3JS94vuJJi0WK1dpoNeVEUjXbzaGELE6ZQW9HGNkb8VktScigsbzancJj6ilH4R0lIEmORqco/A3bqn7BRQDtAA7FeMDM+DZgrHAsH9kg3Fk5fs4lB7x/6KNzdAqQrEVpUyMuRcaXsEVhO2bEqcwLpEh4bUO+VT7M48077fty2jmRFXXXkMLLKtsCxD9OezM3grq6iGdwxUxV6j5AiJCL7SjsNFWRCo1N9bNfrcaNKcE3oOr7QM3jyUy2Acn3u5cp9RCF51Lc7JcBGjRtmVwqVo2vnq7VfOt9GRnLiT+DJhE1DdKhYcnLqZlG1K8PWSmOKZkiXU7elx8X4FyftoxpwfEESJWcMI887eKxIDLRHU27o9QNMYXpJFFT/TGFuTIFvpuLogvdwWdcU/yb03Sk4KtlRJXeKJnh+bHoIRcgvhOWlRxA1p9iU5mXWg/W4WDC0lYbr6VZ3Z84kWBgsGuK7eh7cAoHTL08OB3jl2Z7OWeKkXyweU=

install: 

 - "./gradlew clean jar"


script:
  - COVERAGE=${COVERAGE} 

after_success:
  - ./gradlew jacocoTestReport
  - find . -name jacocoTestReport.csv|xargs cat|awk -F',' '{print $3" "$4" "$5}'
  

 
before _deploy:
 - COVERAGE=$COVERAGE ./gradlew test jacocoTestCoverageVerification

deploy:
 - provider: script
   script: bash -c "echo \"${DOCKER_PASSWORD}" | docker login --username \"${DOCKER_LOGIN}\" --password-stdin"

