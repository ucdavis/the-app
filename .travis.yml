language: java
jdk: oraclejdk8
env:
  - COVERAGE=0.0 BUILD_TARGET=./monolithic/service/user
  - COVERAGE=0.397 BUILD_TARGET=./monolithic/repository/order
  - COVERAGE=0.124 BUILD_TARGET=./monolithic/repository/product
  - COVERAGE=0.148 BUILD_TARGET=./monolithic/service/cart

script:
  - ./gradlew clean jar
before_cache:
  - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/modules-2/
    - $HOME/.gradle/wrapper/dists/

    stages:
      - test
    jobs:
      include:
        - stage: test
          name: unit-test
          install: skip
          script:
            - ./gradlew test
        - stage: test
          name: coverage-test
          install: skip
          script:
            - ./gradlew -p $BUILD_TARGET check
          after_success:
            - ./gradlew jacocoTestReport
            - find . -name jacocoTestReport.csv|xargs cat|awk -F',' '{print $3" "$4" "$5}'
